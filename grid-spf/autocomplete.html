<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Grid: Filtering</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="grid.css">
	<link rel="stylesheet" href="../demos/demos.css">
	<script src="../jquery-1.6.2.js"></script>
	<script src="../external/jquery.tmpl.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.position.js"></script>
	<script src="../ui/jquery.ui.menu.js"></script>
	<script src="../ui/jquery.ui.autocomplete.js"></script>
	<script src="../grid-editing/observable.js"></script>
	<script src="dataview.js"></script>
	<script src="grid.js"></script>

	<script>
	$(function() {
		var cities = $.ui.dataview({
			source: function( request, response ) {
				$.ajax({
					url: "http://ws.geonames.org/searchJSON",
					dataType: "jsonp",
					data: {
						featureClass: "P",
						style: "full",
						maxRows: 12,
						name_startsWith: request.filter.term
					},
					success: function( data ) {
						var result = $.map( data.geonames, function( item ) {
							return $.extend({
								label: item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", " + item.countryName,
								value: item.name
							}, item );
						});
						response( result, data.totalResultsCount );
					}
				});
			}
		});

		$("#city").autocomplete({
			minLength: 3,
			source: function( request, response ) {
				cities.option( "filter", request ).refresh( function() {
					response( cities.result );
				});
			}
		});

		// secondary view
		// TODO the table is empty, so let's create it from scratch here
		var grid = $( "#table1" ).grid({
			source: cities.result,
			columns: [
				{ property: "name", label: "Name" },
				{ property: "adminName1", label: "Area" },
				{ property: "adminName2", label: "Province" },
				{ property: "population", label: "Population" },
				{ property: "countryName", label: "Country" }
			]
		});
	});
	</script>
</head>
<body>

<h1>Autocomplete with custom dataview and secondary grid view</h1>
<p>features: filtering</p>

<form>
	<label for="city">City</label><input id="city">
</form>

<div style="width:70em;">
<table id="table1">
	<thead>
	</thead>
	<tbody>
	</tbody>
</table>
</div>

</body>
</html>
