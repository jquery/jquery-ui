<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Photo Slideshow</title>
	<link rel="stylesheet" href="../themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="grid.css">
	<script src="../jquery-1.6.2.js"></script>
	<script src="../external/kite.js"></script>
	<script src="../ui/jquery.ui.core.js"></script>
	<script src="../ui/jquery.ui.widget.js"></script>
	<script src="../ui/jquery.ui.position.js"></script>
	<script src="../ui/jquery.ui.button.js"></script>
	<script src="../grid-editing/observable.js"></script>
	<script src="datasource.js"></script>
	<script src="slideshow.js"></script>
	<script src="pager.js"></script>
	<script type="text/x-kite" id="pager-tmpl">
		<div class="controls">
			<button data-page="first">First</button>
			<button data-page="prev">Prev</button>
			<button data-page="prevStep">-1</button>
			<span>
				Page <input class="current" size="4">/<span class="total">0</span>,
				Total records <span class="totalRecords">0</span>
			</span>
			<button data-page="nextStep">+1</button>
			<button data-page="next">Next</button>
			<button data-page="last">Last</button>
		</div>
	</script>
	<script type="text/x-kite" id="photo-tmpl">
		<a href="{{href}}" title="{{title}}">
			<img src="{{src}}" width="{{width}}" height="{{height}}" alt="{{alt}}">
		</a>
	</script>
	<script>
	$(function() {
		var datasource = $.ui.datasource({
			paging: {
				limit: 2
			},
			source: function( request, response ) {
				$.ajax({
					url: "http://api.flickr.com/services/rest/",
					dataType: "jsonp",
					jsonpCallback: "jsonFlickrApi",
					data: {
						format: "json",
						api_key: "d86848d57cb3f7ad94f2ee9a3c90eff1",
						method: "flickr.photos.search",
						tags: request.filter,
						sort: "relevance",
						per_page: request.paging.limit,
						page: request.page
					},
					success: function( data ) {
						var result = $.map( data.photos.photo, function( photo ) {
							return {
								src: kite( "http://farm{{farm}}.static.flickr.com/{{server}}/{{id}}_{{secret}}_m.jpg", photo ),
								href: kite( "http://www.flickr.com/photos/{{owner}}/{{id}}/", photo )
							}
						});
						response( result, data.photos.total );
					}
				});
			}
		});

		$( "#slideshow" ).slideshow({
			source: datasource
		});

		$( kite( "#pager-tmpl" )() ).insertBefore( "#slideshow" ).pager({
			source: datasource
		});

		$( "#page-size" ).change( function() {
			datasource.option( "paging.limit", +$( this ).val() ).refresh();
		});

		$( "#filter" ).change(function() {
			datasource.option( "filter", $( this ).val() ).refresh();
		}).trigger( "change" );
	});
	</script>
</head>
<body>

<h1>Photo Slideshow</h1>
<p>features: paging, filtering</p>

<hr>

<p>
	Per page: <input id="page-size" value="2">
</p>
<p>
	Tags to look for (comma seperated): <input id="filter" value="jquery">
</p>


<div id="slideshow"></div>

</body>
</html>
