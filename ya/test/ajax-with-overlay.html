<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame 
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <title>ajax-with-overlay</title>
  <meta name="description" content="" />
  <meta name="author" content="13" />

  <link rel="stylesheet" href="../themes/base.css" />
  <link rel="stylesheet" href="../jqui/css/jquery-ui.css" />
  <style type="text/css">
  	.ajax-overlay-wrapper{
  		background: #000000;
  		opacity:0.5;
  		filter:alpha(opacity=50);
  		z-index:10000;
  	}
  </style>
  <script src="../jqui/js/jquery.min.js"></script>
  <script src="../jqui/js/jquery-ui.min.js"></script>
  <script src="../external/spin.js"></script>
  <script src="../external/jquery.bgiframe-2.1.2.js"></script>
  <script type="text/javascript">
  		//ajax是一个工具函数，对jQuery.ajax进行包装
  		var ajax=function(ajaxOpts,modal){
  			modal=modal||false;	//默认不显示遮罩
  			var overlayJq=$('#ajax-overlay');	//保证"ajax-overlay" id页面唯一
  			if(overlayJq.length==0){
  				overlayJq=$('<div id="ajax-overlay" class="ui-overlay ajax-overlay-wrapper"></div>').css({
  					"position":"absolute",
  					"top":"-100000px",	//偏移式隐藏
  					"left":"-100000px",
  					"width":"100%",
  					"height":"100%",
  					"display":"block",
  					"overflow":"hidden"
  				}).appendTo('body');
  				overlayJq.bgiframe();	//ie6 select问题
  				//加载符，参考 http://fgnass.github.com/spin.js/，或者用动态图片居中放置
  				new Spinner({
  					color: '#ffffff'
  				}).spin(overlayJq.get(0));
  			}
  			if(modal){
  				var completeFn=ajaxOpts.complete;
  				if(completeFn){
  					ajaxOpts.complete=function(){
  						overlayJq.css({
		  					"top":"-100000px",
		  					"left":"-100000px"
		  				});
  						completeFn.apply(this,arguments);
  					};
  				}
  				//发送请求前显示遮罩
  				overlayJq.css({
  					"top":"0px",
  					"left":"0px"
  				});
  			}
  			$.ajax(ajaxOpts);
  		};
  		jQuery(function($){
  			$('#ajax-h').click(function(){
  				ajax({
  					url:'data.json',
  					type:'post',
  					dataType:'json',
  					success:function(data){
  						$('#mess').html('success');
  					},
  					error:function(){
  						$('#mess').html('error');
  					},
  					complete:function(){
  						$('#mess').html('complete');
  					}
  				},true);
  				return false;
  			});
  		});
  </script>
</head>

<body>
  <button id="ajax-h">loading data</button>
  <div id="mess"></div>
</body>
</html>
